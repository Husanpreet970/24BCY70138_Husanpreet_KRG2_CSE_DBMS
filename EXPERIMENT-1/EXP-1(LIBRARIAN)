SELECT CURRENT_USER;

CREATE TABLE books (
    id INT PRIMARY KEY,
    name VARCHAR(20) NOT NULL,
    author_name VARCHAR(30) NOT NULL
);

INSERT INTO books (id, name, author_name)
VALUES (140, 'The Tiger King', 'J.K. Rowling');
SELECT * FROM books;

ALTER TABLE books
ADD COUNT INT CHECK(COUNT>=1);

SELECT * FROM books;

UPDATE books
SET COUNT=3 WHERE ID=120;

SELECT * FROM books;

CREATE TABLE library_visitor(
USER_ID INT PRIMARY KEY,
USER_NAME VARCHAR(20),
AGE INT CHECK(AGE>=17) NOT NULL,
EMAIL_ID VARCHAR(20) UNIQUE NOT NULL
);

INSERT INTO library_visitor(USER_ID,USER_NAME,AGE,EMAIL_ID) VALUES(101,'aly',19,'abcd@gmail.com');
SELECT * FROM library_visitor;

UPDATE library_visitor
SET USER_NAME='vikas'
WHERE USER_ID=102;

ALTER TABLE library_visitor
ALTER COLUMN EMAIL_ID TYPE VARCHAR(50);

INSERT INTO library_visitor(USER_ID,USER_NAME,AGE,EMAIL_ID) VALUES(102,'aman',21,'efgh@gmail.com');

ALTER TABLE library_visitor
DROP COLUMN EMAIL_ID;

ALTER TABLE library_visitor
ADD COLUMN EMAIL_ID VARCHAR(30) UNIQUE;

UPDATE library_visitor
SET EMAIL_ID='AK@GMAIL.COM'
WHERE USER_ID=101;

UPDATE library_visitor
SET EMAIL_ID='BF@GMAIL.COM'
WHERE USER_ID=102;

CREATE TABLE book_issue(
BOOK_ISSUE_ID INT PRIMARY KEY,
BOOK_ID INT REFERENCES books(ID),
USER_ID INT REFERENCES library_visitor(USER_ID) NOT NULL,
BOOK_ISSUE DATE NOT NULL
);

INSERT INTO book_issue VALUES(555,140,101,'05-01-2026');

SELECT * FROM book_issue;

CREATE ROLE librarian
WITH LOGIN PASSWORD 'Husan_123';

GRANT SELECT, INSERT, DELETE, UPDATE ON books TO librarian;
GRANT SELECT, INSERT, DELETE, UPDATE ON book_issue TO librarian;
GRANT SELECT, INSERT, DELETE, UPDATE ON library_visitor TO librarian;

REVOKE SELECT, INSERT, DELETE, UPDATE ON library_visitor FROM librarian;
